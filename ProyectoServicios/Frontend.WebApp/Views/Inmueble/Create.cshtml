@model Frontend.WebApp.Models.CrearInmuebleViewModel
@{
    ViewData["Title"] = "Create";
}

<h2>Nuevo Inmueble</h2>

@if (ViewBag.Mensaje != null)
{
    <div class="alert alert-danger">@ViewBag.Mensaje</div>
}

<div class="row">
    <div class="col-md-6">
        <form asp-action="Create" method="post" enctype="multipart/form-data">
            @Html.AntiForgeryToken()
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <div class="mb-3">
                <label asp-for="Nombre" class="form-label"></label>
                <input asp-for="Nombre" class="form-control" />
                <span asp-validation-for="Nombre" class="text-danger"></span>
            </div>

            <div class="mb-3">
                <label asp-for="Capacidad" class="form-label"></label>
                <input asp-for="Capacidad" type="number" class="form-control" />
                <span asp-validation-for="Capacidad" class="text-danger"></span>
            </div>

            <div class="mb-3">
                <label asp-for="Numero_Habitaciones" class="form-label"></label>
                <input asp-for="Numero_Habitaciones" type="number" class="form-control" />
                <span asp-validation-for="Numero_Habitaciones" class="text-danger"></span>
            </div>

            <div class="mb-3">
                <label asp-for="Precio_Por_Noche" class="form-label"></label>
                <input asp-for="Precio_Por_Noche" type="number" step="0.01" class="form-control" />
                <small class="text-muted">Usa punto decimal (ej. 400.00)</small>
                <span asp-validation-for="Precio_Por_Noche" class="text-danger"></span>
            </div>

            <div class="mb-3">
                <label asp-for="Disponibilidad" class="form-label"></label>
                <select asp-for="Disponibilidad" class="form-select">
                    <option value="Si">Si</option>
                    <option value="No">No</option>
                </select>
                <span asp-validation-for="Disponibilidad" class="text-danger"></span>
            </div>

            <div class="mb-3">
                <label asp-for="Servicios_Incluidos" class="form-label"></label>
                <input asp-for="Servicios_Incluidos" class="form-control" />
                <span asp-validation-for="Servicios_Incluidos" class="text-danger"></span>
            </div>

            <div class="mb-3">
                <label asp-for="Descripcion" class="form-label"></label>
                <textarea asp-for="Descripcion" rows="3" class="form-control"></textarea>
                <span asp-validation-for="Descripcion" class="text-danger"></span>
            </div>

            <!-- Archivo: el API espera el campo como "imagen" -->
            <div class="mb-3">
                <label class="form-label">Imagen (Cloudinary)</label>
                <input asp-for="Imagen" type="file" class="form-control" />
                <small class="text-muted">Se sube a Cloudinary; el API guardará la URL.</small>
            </div>

            <div class="mb-3">
                <label class="form-label">Latitud</label>
                <input asp-for="Latitud" type="text" class="form-control" id="Latitud" readonly />
                <span asp-validation-for="Latitud" class="text-danger"></span>
            </div>

            <div class="mb-3">
                <label class="form-label">Longitud</label>
                <input asp-for="Longitud" type="text" class="form-control" id="Longitud" readonly />
                <span asp-validation-for="Longitud" class="text-danger"></span>
            </div>

            <div class="mt-3">
                <button type="submit" class="btn btn-success">Guardar</button>
                <a asp-action="Index" class="btn btn-secondary">Volver</a>
            </div>
        </form>
    </div>

    <div class="col-md-6">
        <label class="form-label">Ubicación (clic en el mapa)</label>
        <div id="map" style="height:420px;border:1px solid #ddd;border-radius:6px"></div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        let map, marker;
        function initMap() {
          const start = { lat: -12.0464, lng: -77.0428 }; // Lima por defecto
          map = new google.maps.Map(document.getElementById("map"), { center: start, zoom: 12 });

          map.addListener("click", (e) => {
            const pos = e.latLng;
            if (!marker) marker = new google.maps.Marker({ map: map });
            marker.setPosition(pos);
            // setea valores con punto decimal, 6 decimales
            document.getElementById("Latitud").value = pos.lat().toFixed(6);
            document.getElementById("Longitud").value = pos.lng().toFixed(6);
          });
        }
        window.initMap = initMap;
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCc1pV5K0s9Z7xGUUU03n6zBhKemKLiRx8&callback=initMap" async defer></script>
}
