@model Shared.Models.InmuebleDto

@{
    Layout = null;
    ViewData["Title"] = "Detalle de Inmueble";
    @Html.Partial("_NavAdmin")
}

<link rel="stylesheet" href="@Url.Content("~/css/MantInmueble.css")" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<br />

<h2 class="text-center">DETALLES DEL INMUEBLE CON ID @Model.IdInmueble</h2>

<div class="container mt-4">
    <div class="form-horizontal">
        <h4 class="text-center">Consulta de datos</h4>
        <hr />
        <br />
        <div class="form-row">
            <div class="form-group col-md-6">
                <label class="control-label">Nombre</label>
                <p class="form-control">@Model.Nombre</p>
            </div>
            <div class="form-group col-md-6">
                <label class="control-label">Capacidad</label>
                <p class="form-control">@Model.Capacidad</p>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group col-md-6">
                <label class="control-label">Número de Habitaciones</label>
                <p class="form-control">@Model.NumeroHabitaciones</p>
            </div>
            <div class="form-group col-md-6">
                <label class="control-label">Precio por Noche</label>
                <p class="form-control">@Model.PrecioPorNoche</p>
            </div>
        </div>

        <div class="form-group">
            <label class="control-label">Descripción</label>
            <p class="form-control1">@Model.Descripcion</p>
        </div>

        <div class="form-row">
            <div class="form-group col-md-6">
                <label class="control-label">Servicios Incluidos</label>
                <p class="form-control">@Model.ServiciosIncluidos</p>
            </div>
            <div class="form-group col-md-6">
                <label class="control-label">Disponibilidad</label>
                <p class="form-control">@Model.Disponibilidad</p>
            </div>
        </div>

        <div class="col-md-12 text-center">
            <label class="control-label">Imagen de Habitación</label>
            @if (!string.IsNullOrEmpty(Model.ImagenHabitacion))
            {
                <img src="@Model.ImagenHabitacion" alt="Imagen del inmueble" class="img-fluid mb-3 mt-2"
                     style="max-height:400px; border-radius:10px;" />
            }
            else
            {
                <p><em>No hay imagen disponible</em></p>
            }
        </div>

@if (Model.Latitud.HasValue && Model.Longitud.HasValue)
{
            <div class="col-md-12 text-center">
                <label class="control-label">Ubicación en el Mapa</label>
                <div class="map-wrapper">
                    <div id="map" style="height: 400px;"></div>
                </div>

                <script>
                    // Fuerza punto decimal desde Razor -> JS
                    const lat = parseFloat('@Model.Latitud.Value.ToString(System.Globalization.CultureInfo.InvariantCulture)');
                    const lng = parseFloat('@Model.Longitud.Value.ToString(System.Globalization.CultureInfo.InvariantCulture)');
                    const nombre = "@Model.Nombre";

                    // Google llama a window.initMap
                    window.initMap = function () {
                        if (isNaN(lat) || isNaN(lng)) return;

                        const ubicacion = { lat: lat, lng: lng };
                        const map = new google.maps.Map(document.getElementById("map"), {
                            zoom: 15,
                            center: ubicacion,
                        });

                        new google.maps.Marker({
                            position: ubicacion,
                            map: map,
                            title: nombre
                        });
                    };
                </script>

                <!-- Carga recomendada por Google -->
                <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCc1pV5K0s9Z7xGUUU03n6zBhKemKLiRx8&callback=initMap&v=weekly&loading=async"
                        defer>
                </script>
            </div>
}
else
{
            <p><em>Este inmueble no tiene ubicación registrada</em></p>
}
